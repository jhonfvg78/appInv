<!DOCTYPE html>

<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="/"
    data-template="vertical-menu-template-free">



@include('partials/head')

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->
            @include('partials/aside')
            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->
                {{-- @include('partials/header') --}}
                <!-- Content wrapper -->
                <div class="content-wrapper">
                    <!-- Content -->
                    <div class="container mt-2">
                        <div class="card">
                            <div class="card-header">
                                <nav class="navbar navbar-dark navbar-expand-md bg-dark ">
                                    <div class="container"> 
                                        <div class="d-flex flex-row">   
                                            @if(mode)                                        
                                            <a class="example-image-link" href="{{ user.photo }}"
                                            data-lightbox="roadtrip">                                           
                                            <img class="rounded float-start" height="50px"
                                                onerror="imageError(event)" src="{{ user.photo }}" />
                                            </a>
                                            @endif
                                            <div class="d-flex flex-column ms-2 mt-1">
                                                <small class="mb-1"><i class="fa-solid fa-list-check me-1"></i> PRÉSTAMOS: {{count}}</small>
                                                @if(mode)
                                                <small class="text-muted">{{user.name}} {{user.lastname}} - {{user.identification}}</small>                                                
                                                @endif
                                            </div>
                                        </div>
                                        <button class="navbar-toggler" data-bs-toggle="collapse"
                                            data-bs-target="#navcol-5">
                                            <span class="visually-hidden">Toggle
                                                navigation</span>
                                            <span class="navbar-toggler-icon"></span>
                                        </button>
                                        <div id="navcol-5" class="collapse navbar-collapse">
                                            <ul class="navbar-nav ms-auto">
                                                <li class="nav-item nav-link">
                                                    <input type="text" class="form-control-sm border shadow-none"
                                                        placeholder="Buscar usuario" onchange="itemSearch(this.value)"
                                                        autofocus />
                                                </li>
                                                <li class="nav-item nav-link">                                                    
                                                    <div class="btn-group" role="group"
                                                        aria-label="Basic mixed styles example">
                                                        <a href="/user/group/NA" class="btn btn-primary btn-sm"
                                                            aria-current="page" data-bs-toggle="tooltip"
                                                            data-bs-placement="top" data-bs-title="Usuarios"><i
                                                                class="fa-solid fa-user"></i></a>
                                                        <button type="button" class="btn btn-warning btn-sm"
                                                            onclick=" selectAllRows()" data-bs-toggle="tooltip"
                                                            data-bs-placement="top" data-bs-title="Seleccionar"><i
                                                                class="fa-solid fa-list-check"></i></button>
                                                        <button type="button" class="btn btn-info btn-sm"
                                                            onclick=" deselectAllRows()" data-bs-toggle="tooltip"
                                                            data-bs-placement="top"
                                                            data-bs-title="Deseleccionar"><i
                                                                class="fa-solid fa-list-ul"></i></button>
                                                    </div>
                                                </li>
                                                <li class="nav-item nav-link">
                                                    <!-- Button trigger modal -->
                                                    <button type="button" class="btn btn-success btn-sm"
                                                        onclick=" showModal()">
                                                        Recibir
                                                    </button>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </nav>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive text-nowrap">
                                    <div id="events">
                                        <div class="overflow-auto p-3 bg-light"
                                            style="max-width: 1000vw; max-height:100vh">
                                            <table id="dataTables"
                                                class="table table-striped table-hover table-row-border table-order-column m-3 p-3"
                                                style="width: 100%">
                                                <thead>
                                                    <tr>
                                                        <th>Id</th>
                                                        <th>Ingreso</th>
                                                        <th>Referencia</th>
                                                        <th>Cantidad</th>
                                                        <th>Tiempo[1-30] > días</th>
                                                        <th>image</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @each(loan in loans)
                                                    <tr>
                                                        <td>{{ loan.id }}</td>
                                                        <td>{{ loan.admission.toLocaleString() }}</td>
                                                        <td>{{ loan.reference }}</td>
                                                        <td>{{ loan.quantity }}
                                                        <td>
                                                            <div class="progress" style="width: 120px; height: 15px">
                                                                @if(loan.days<=7)
                                                                    <div class="progress-bar progress-bar-striped bg-info" role="progressbar" style="width: {{ loan.days *100/30}}%" aria-valuenow="{{ loan.days *100/30}}" aria-valuemin="0" aria-valuemax="30">{{ Math.floor(loan.days) }}</div>
                                                                @elseif(loan.days>7&&loan.days<=14)
                                                                    <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: {{ loan.days *100/30}}%" aria-valuenow="{{ loan.days *100/30}}" aria-valuemin="0" aria-valuemax="30">{{ Math.floor(loan.days) }}</div>
                                                                @elseif(loan.days>14&&loan.days<=21)
                                                                    <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: {{ loan.days *100/30}}%" aria-valuenow="{{ loan.days *100/30}}" aria-valuemin="0" aria-valuemax="30">{{ Math.floor(loan.days) }}</div>
                                                                @elseif(loan.days>21)
                                                                    <div class="progress-bar progress-bar-striped bg-danger" role="progressbar" style="width: {{ loan.days *100/30}}%" aria-valuenow="{{ loan.days *100/30}}" aria-valuemin="0" aria-valuemax="30">{{ Math.floor(loan.days) }}</div>
                                                                @endif
                                                            </div>
                                                        </td>
                                                        <td> <a class="example-image-link" href="{{ loan.image }}"
                                                                data-lightbox="roadtrip">
                                                                <img class="rounded float-start" height="50px"
                                                                    onerror="imageError(event)"
                                                                    src="{{ loan.image }}" />
                                                            </a>
                                                        </td>
                                                    </tr>
                                                    @end
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Footer -->
                @include('partials/footer')
            </div>
        </div>
        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>
    </div>

    <!-- Modal Categories-->
    <div class="modal fade " id="loanModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">RECIBIR ELEMENTOS</h5>
                    <li class="nav-item nav-link">
                        <span class="badge rounded-pill bg-primary" id="countItems">
                        </span>
                    </li>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-striped table-sm" id="tableItemRemove">
                        <thead>
                            <tr>
                                <th style="display:none;">Id</th>
                                <th scope="col">Referencia</th>
                                <th scope="col">Cantidad</th>
                                <th>Tiempo[1-30] > días</th>
                                <th>image</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    </table>

                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" type="button" data-bs-toggle="modal"
                        onclick="updateItem()">Recibir</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    @include('partials/scripts')

    <!-- ScriptPage -->
    <script src="/pages/loan.js"></script>
    <script type="text/javascript" src="/libraries/DataTables/dataTables.select.min.js"></script>
</body>

</html>